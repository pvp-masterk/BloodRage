<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Manage Links - BloodRage</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- âœ… Include this inside <head> -->
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
</head>
<body class="bg-black text-white font-sans">

  <div class="flex min-h-screen">

    <!-- Sidebar -->
    <aside class="w-64 bg-zinc-900 p-6 space-y-4">
      <h1 class="text-2xl font-bold text-red-500 mb-6">BloodRage</h1>
      <nav class="space-y-3">
        <a href="dashboard.html" class="block px-3 py-2 rounded hover:bg-zinc-800">Account</a>
        <a href="customize.html" class="block px-3 py-2 rounded hover:bg-zinc-800">Customize</a>
        <a href="links.html" class="block px-3 py-2 rounded bg-red-700">Links</a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-8">
      <h2 class="text-3xl font-bold text-red-500 mb-6">Manage Profile Links</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-6" id="app-icons">
        <!-- App icons rendered here -->
      </div>

      <div id="saving" class="mt-6 text-green-400 hidden">Link saved!</div>
    </main>
  </div>

  <!-- Link Modal -->
  <div id="modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center hidden z-50">
    <div class="bg-zinc-900 p-6 rounded-lg max-w-sm w-full">
      <h3 class="text-xl font-bold mb-4 text-red-500" id="modalTitle">Enter your link</h3>
      <input id="linkInput" type="text" class="w-full p-2 rounded bg-zinc-800 text-white mb-4" placeholder="https://..." />
      <div class="flex justify-end space-x-2">
        <button onclick="closeModal()" class="bg-zinc-700 hover:bg-zinc-600 px-4 py-2 rounded">Cancel</button>
        <button onclick="saveLink()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded">Save</button>
      </div>
    </div>
  </div>

  <!-- Supabase -->
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
    const supabase = createClient("https://smcteblolwhfxcpngmvd.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNtY3RlYmxvbHdoZnhjcG5nbXZkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0Nzk1MTUsImV4cCI6MjA3MDA1NTUxNX0.PWlZFiVv2E0Jah7tYGOGrbqkPwhxPoLhe0anINp0z3s");

   const apps = [
  { name: "Discord", icon: "bxl-discord", base: "https://discord.gg/" },
  { name: "X", icon: "bxl-twitter", base: "https://x.com/" },
  { name: "YouTube", icon: "bxl-youtube", base: "https://youtube.com/" },
  { name: "GitHub", icon: "bxl-github", base: "https://github.com/" }
];

    let selectedApp = null;
    let profile = null;
    const user = (await supabase.auth.getUser()).data.user;
    if (!user) window.location.href = '/';

    const { data } = await supabase
      .from("profiles")
      .select("*")
      .eq("id", user.id)
      .single();
    profile = data;

    if (!user) {
  console.error("No Supabase user found.");
  window.location.href = '/';
}

console.log("Logged in as:", user.email);
console.log("Profile data:", profile);


    const appIconsDiv = document.getElementById("app-icons");

    apps.forEach(app => {
      const btn = document.createElement("button");
      btn.className = "flex flex-col items-center p-4 bg-zinc-800 rounded hover:bg-zinc-700 transition";
      btn.onclick = () => openModal(app);

      const icon = document.createElement("box-icon");
      icon.setAttribute("type", "logo");
      icon.setAttribute("name", app.icon.split('-')[1]);
      icon.setAttribute("color", "white");
      icon.setAttribute("size", "lg");

      const label = document.createElement("span");
      label.className = "mt-2 text-sm";
      label.innerText = app.name;

      // Check if user already has this link set
      const link = profile?.links?.[app.name];
      if (link) {
        btn.classList.add("border", "border-red-500");
        btn.title = `Current: ${link}`;
        btn.onclick = () => window.open(link, "_blank");
      } else {
        btn.onclick = () => openModal(app);
      }

      btn.appendChild(icon);
      btn.appendChild(label);
      appIconsDiv.appendChild(btn);
    });

    window.openModal = function (app) {
      selectedApp = app;
      document.getElementById("modalTitle").innerText = `Your ${app.name} username or U
